Content-Type: multipart/mixed; boundary="//"
MIME-Version: 1.0

--//
Content-Type: text/cloud-config; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="cloud-config.txt"

#cloud-config
cloud_final_modules:
- [scripts-user, always]

output:
    init:
        output: "> /var/log/cloud-init.out"
        error: "> /var/log/cloud-init.err"
    config: "tee -a /var/log/cloud-config.log"
    final:
        - ">> /var/log/cloud-final.out"
        - "/var/log/cloud-final.err"
--//
Content-Type: text/x-shellscript; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="userdata.txt"

#!/bin/bash
/bin/echo "Hello World" >> /tmp/testfile.txt
sudo yum update -y
sudo yum install -y aws-cfn-bootstrap
sudo amazon-linux-extras install docker

sudo service docker stop
sudo rm /var/lib/docker/network/files/local-kv.db
sudo service docker start
sudo usermod -a -G docker ec2-user
$(aws ecr get-login --no-include-email --region us-east-2)
docker pull 281517792612.dkr.ecr.us-east-2.amazonaws.com/hello-world:latest
docker run --log-driver=awslogs --log-opt awslogs-group=ntno-challenge-docker-logs -p 443:443 -p 80:80 -d 281517792612.dkr.ecr.us-east-2.amazonaws.com/hello-world:latest
/opt/aws/bin/cfn-signal \
    -e $? \
    --stack ntno-challenge-app-deploy \
    --resource AmazonLinuxInstance \
    --region us-east-2
--//